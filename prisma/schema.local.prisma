// 로컬 개발용 SQLite 스키마
// 사용법: cp prisma/schema.local.prisma prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  nickname  String   @unique
  password  String
  rating    Int      @default(1500)
  wins      Int      @default(0)
  losses    Int      @default(0)
  draws     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  gamesAsBlack Game[] @relation("BlackPlayer")
  gamesAsWhite Game[] @relation("WhitePlayer")
  moves        GameMove[]
}

model Game {
  id          String   @id @default(uuid())
  blackId     String
  whiteId     String
  blackRating Int
  whiteRating Int
  result      String?  // "black_win", "white_win", "draw"
  sgfData     String?  // SGF format game data
  isAiGame    Boolean  @default(false)
  aiLevel     Int?
  aiColor     String?  // "black" or "white"
  startedAt   DateTime @default(now())
  endedAt     DateTime?
  createdAt   DateTime @default(now())

  blackPlayer User?     @relation("BlackPlayer", fields: [blackId], references: [id])
  whitePlayer User?     @relation("WhitePlayer", fields: [whiteId], references: [id])
  moves       GameMove[]

  @@index([blackId])
  @@index([whiteId])
  @@index([startedAt])
}

model GameMove {
  id        String   @id @default(uuid())
  gameId    String
  userId    String?
  moveNumber Int
  color     String   // "black" or "white"
  x         Int?     // 0-18 (null for pass)
  y         Int?     // 0-18 (null for pass)
  isPass    Boolean  @default(false)
  timestamp DateTime @default(now())

  game Game @relation(fields: [gameId], references: [id], onDelete: Cascade)
  user User? @relation(fields: [userId], references: [id])

  @@index([gameId])
  @@index([gameId, moveNumber])
}

model Ranking {
  id        String   @id @default(uuid())
  userId    String   @unique
  rating    Int      @default(1500)
  rank      Int?
  updatedAt DateTime @updatedAt

  @@index([rating])
  @@index([rank])
}

